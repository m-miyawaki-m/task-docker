# オフライン環境でのWindowsパッケージ配布ガイド

## 概要

オフライン環境で共有リポジトリから各開発ツールを取得・インストールする方法を解説します。

---

## パッケージマネージャー比較

| 項目 | winget | Chocolatey | Scoop |
|------|--------|------------|-------|
| **オフライン対応** | △ 制限あり | ◎ 完全対応 | ○ 対応可能 |
| **ローカルリポジトリ** | △ 複雑 | ◎ 簡単 | ○ bucket作成 |
| **管理者権限** | 不要 | 必要 | 不要 |
| **企業利用** | 無料 | 無料/有料版あり | 無料 |
| **定義ファイル** | JSON/YAML | XML | JSON |
| **バージョン固定** | △ | ◎ | ◎ |
| **依存関係解決** | ◎ | ◎ | ○ |
| **インストール先** | Program Files | ProgramData/chocolatey | ~/scoop |

---

## 検討事項チェックリスト

### A. 環境要件

| 検討項目 | 確認内容 |
|----------|----------|
| 管理者権限 | 開発者PCに管理者権限はあるか？ |
| ネットワーク | 完全オフラインか、社内ネットワークのみか？ |
| 共有フォルダ | ファイルサーバーへのアクセス権限は？ |
| Windows版 | Windows 10/11のどちらか？バージョンは？ |

### B. 運用要件

| 検討項目 | 確認内容 |
|----------|----------|
| 管理者 | パッケージの更新は誰が行うか？ |
| 頻度 | ツールの更新頻度は？ |
| 統一性 | 全員同じバージョンを使う必要があるか？ |
| 監査 | インストール状況の把握は必要か？ |

### C. 対象ツール

| 検討項目 | 確認内容 |
|----------|----------|
| ツール一覧 | 配布するツールは何か？（JDK, Gradle, Node等） |
| バージョン | 特定バージョンに固定するか？ |
| 設定 | 環境変数の自動設定は必要か？ |
| 依存関係 | ツール間の依存関係はあるか？ |

### D. セキュリティ・ポリシー

| 検討項目 | 確認内容 |
|----------|----------|
| 承認 | 社内でパッケージマネージャーの利用は許可されているか？ |
| 検証 | パッケージの署名検証は必要か？ |
| 監査 | インストールログの保存は必要か？ |

---

## 推奨判断フロー

```
管理者権限あり？
  │
  ├─ Yes ──→ バージョン厳密管理必要？
  │            │
  │            ├─ Yes ──→ Chocolatey（推奨）
  │            │
  │            └─ No ───→ winget or Chocolatey
  │
  └─ No ───→ Scoop（推奨）
```

---

## 各ツールのオフライン構成

### Chocolatey（推奨）

```
\\fileserver\dev-tools\
├── chocolatey\
│   ├── chocolatey.0.12.1.nupkg      ← Chocolatey本体
│   ├── openjdk11.11.0.21.nupkg
│   ├── gradle.7.6.1.nupkg
│   └── nodejs-lts.18.19.0.nupkg
├── packages.config
└── setup.ps1
```

### Scoop

```
\\fileserver\dev-tools\
├── scoop\
│   ├── scoop-main\                  ← main bucket
│   └── scoop-java\                  ← java bucket
├── apps\
│   ├── openjdk11-*.zip
│   ├── gradle-*.zip
│   └── nodejs-*.zip
└── setup.ps1
```

### winget

```
\\fileserver\dev-tools\
├── winget-pkgs\
│   └── manifests\                   ← パッケージマニフェスト
├── installers\
│   ├── openjdk-11.0.21.msi
│   └── gradle-7.6.1-all.zip
└── setup.ps1
```

---

## 推奨構成まとめ

| 条件 | 推奨ツール | 理由 |
|------|------------|------|
| 管理者権限あり + バージョン管理重要 | Chocolatey | オフライン完全対応、バージョン固定容易 |
| 管理者権限なし | Scoop | ユーザー権限で動作、ポータブル |
| シンプルに済ませたい | 手動スクリプト | 依存なし、最も確実 |
