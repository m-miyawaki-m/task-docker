# オフライン環境でのツール管理方式の比較検討

## 概要

オフライン環境で開発ツール（Eclipse, SQLDeveloper, JDK, WebLogic等）を管理する際、以下の選択肢を比較検討します。

| 方式 | 代表例 |
|------|--------|
| パッケージマネージャー | winget, Chocolatey, Scoop |
| 自作スクリプト | CSV + PowerShell |

---

## 要件の確認

今回管理したいツールと要件：

| 要件 | 詳細 |
|------|------|
| 対象ツール | Eclipse, SQLDeveloper, JDK, WebLogic, Git, Maven, Gradle等 |
| 環境 | **完全オフライン** |
| 環境変数 | 必要に応じて自動設定 |
| インストール済み判定 | スキップ機能 |
| バージョン不一致検知 | サマリー出力 |
| アンインストール | 対応必要 |
| ツール内部設定 | 設定ファイルも管理したい |
| 設定管理形式 | CSV等で管理 |

---

## 方式別の評価

### 1. winget

| 項目 | 評価 | 理由 |
|------|------|------|
| オフライン対応 | **△** | ローカルマニフェスト可能だが手間がかかる |
| 環境変数設定 | **×** | 自動設定なし、手動対応必要 |
| インストール済み判定 | **○** | 対応 |
| バージョン不一致検知 | **○** | `winget list` で確認可能 |
| アンインストール | **○** | `winget uninstall` で対応 |
| ツール内部設定管理 | **×** | 非対応 |
| 設定管理（CSV等） | **△** | JSON形式、Excelで編集しにくい |
| 学習コスト | **低** | Microsoft標準 |

**wingetの問題点：**
- オフライン用マニフェスト作成が煩雑
- SHA256ハッシュの記載必須
- 環境変数設定は別途スクリプト必要
- 設定ファイル管理は完全に別管理

---

### 2. Chocolatey

| 項目 | 評価 | 理由 |
|------|------|------|
| オフライン対応 | **○** | ローカルリポジトリ対応 |
| 環境変数設定 | **△** | パッケージ依存、カスタムスクリプト必要な場合あり |
| インストール済み判定 | **○** | 対応 |
| バージョン不一致検知 | **○** | `choco outdated` で確認可能 |
| アンインストール | **○** | `choco uninstall` で対応 |
| ツール内部設定管理 | **×** | 非対応 |
| 設定管理（CSV等） | **△** | packages.config（XML形式） |
| 学習コスト | **中** | nupkg作成の知識必要 |

**Chocolateyの問題点：**
- オフライン用に `.nupkg` 形式への変換が必要
- 管理者権限が必要
- Eclipse, SQLDeveloper等の大型IDEは公式パッケージがないことも
- 設定ファイル管理は完全に別管理

---

### 3. Scoop

| 項目 | 評価 | 理由 |
|------|------|------|
| オフライン対応 | **○** | キャッシュ利用可能 |
| 環境変数設定 | **△** | shims経由、カスタム設定は別途必要 |
| インストール済み判定 | **○** | 対応 |
| バージョン不一致検知 | **○** | `scoop status` で確認可能 |
| アンインストール | **○** | `scoop uninstall` で対応 |
| ツール内部設定管理 | **×** | 非対応 |
| 設定管理（CSV等） | **△** | JSON形式 |
| 学習コスト | **低** | シンプル |

**Scoopの問題点：**
- 管理者権限なしでインストール可能だが、システム全体への適用が難しい
- bucket（リポジトリ）に対象ツールがない場合がある
- 設定ファイル管理は完全に別管理

---

### 4. 自作スクリプト（CSV + PowerShell）

| 項目 | 評価 | 理由 |
|------|------|------|
| オフライン対応 | **◎** | 完全対応（設計次第） |
| 環境変数設定 | **◎** | CSV定義で完全制御可能 |
| インストール済み判定 | **◎** | スクリプトで実装可能 |
| バージョン不一致検知 | **◎** | スクリプトで実装可能 |
| アンインストール | **◎** | スクリプトで実装可能 |
| ツール内部設定管理 | **◎** | configs.csv で管理可能 |
| 設定管理（CSV等） | **◎** | CSV（Excelで編集可能） |
| 学習コスト | **中** | PowerShell知識必要 |

**自作スクリプトの利点：**
- 要件に完全に合わせたカスタマイズが可能
- パッケージマネージャーのオーバーヘッドなし
- 何が起きているか完全に把握可能
- 問題発生時のデバッグが容易

---

## 比較表（総合）

| 項目 | winget | Chocolatey | Scoop | 自作スクリプト |
|------|--------|------------|-------|----------------|
| オフライン対応 | △ | ○ | ○ | **◎** |
| 環境変数設定 | × | △ | △ | **◎** |
| インストール済み判定 | ○ | ○ | ○ | **◎** |
| バージョン不一致検知 | ○ | ○ | ○ | **◎** |
| アンインストール | ○ | ○ | ○ | **◎** |
| **ツール内部設定管理** | × | × | × | **◎** |
| 設定管理（CSV） | △ | △ | △ | **◎** |
| 事前準備の手間 | 多い | 多い | 中 | **少ない** |
| トラブル時の透明性 | △ | △ | ○ | **◎** |
| 依存関係 | 本体必要 | 本体必要 | 本体必要 | **なし** |

---

## 決定的な差異：ツール内部設定管理

今回の要件で最も重要なのは「**各ツールの内部設定も管理したい**」という点です。

### パッケージマネージャーの限界

パッケージマネージャーは「ツール本体のインストール」までが守備範囲です。

| 設定項目 | パッケージマネージャー | 自作スクリプト |
|----------|------------------------|----------------|
| Eclipse formatter.xml | **非対応** | ◎ 対応 |
| Eclipse メモリ設定 (eclipse.ini) | **非対応** | ◎ 対応 |
| Eclipse プラグイン | **非対応** | ◎ 対応 |
| SQLDeveloper 接続情報 | **非対応** | ◎ 対応 |
| Git .gitconfig | **非対応** | ◎ 対応 |
| Maven settings.xml | **非対応** | ◎ 対応 |
| Gradle init.gradle | **非対応** | ◎ 対応 |

パッケージマネージャーを使う場合、結局「設定ファイル管理用の別スクリプト」が必要になります。

### 自作スクリプトの場合

```
packages.csv  → ツール本体のインストール
configs.csv   → 設定ファイルの配置
```

**1つの仕組みで統一管理**が可能です。

---

## オフライン環境での現実的な問題

### パッケージマネージャー使用時の準備作業

```
1. オンライン環境でパッケージをダウンロード
2. パッケージを専用形式に変換（nupkg等）
3. ローカルリポジトリを構築
4. パッケージマネージャー本体もオフラインインストール
5. 設定ファイル管理用の別スクリプト作成
```

### 自作スクリプト使用時の準備作業

```
1. オンライン環境でZIPをダウンロード
2. 共有フォルダに配置
3. 完了
```

---

## 判断フローチャート

```
ツール内部設定も管理したい？
  │
  ├─ Yes ──→ 自作スクリプト（CSV + PowerShell）
  │
  └─ No ───→ 完全オフライン？
               │
               ├─ Yes ──→ 自作スクリプト or Chocolatey
               │          （準備の手間を考慮）
               │
               └─ No ───→ winget（最もシンプル）
```

---

## 結論

### 推奨：自作スクリプト（CSV + PowerShell）

今回の要件では **自作スクリプト** が最適です。

**理由：**

| 要件 | 自作スクリプトでの対応 |
|------|------------------------|
| オフライン環境 | ◎ ZIPを共有フォルダに配置するだけ |
| 環境変数設定 | ◎ packages.csv で定義 |
| インストール済み判定 | ◎ check-installed.ps1 |
| バージョン不一致検知 | ◎ check-installed.ps1 でサマリー出力 |
| アンインストール | ◎ uninstall-dev-env.ps1 |
| **ツール内部設定管理** | ◎ configs.csv + apply-configs.ps1 |
| 設定管理形式 | ◎ CSV（Excelで編集可能） |

### パッケージマネージャーが適するケース

以下の場合はパッケージマネージャーを検討：

| ケース | 推奨 |
|--------|------|
| オンライン環境で使う | winget |
| 依存関係が複雑なツール | Chocolatey |
| 管理者権限がない | Scoop |
| ツール内部設定は不要 | 任意のパッケージマネージャー |

---

## 実装方針

自作スクリプト方式を採用する場合の構成：

```
\\fileserver\dev-tools\
├── packages.csv          ← ツール本体定義
├── configs.csv           ← 設定ファイル定義
├── packages\             ← ツール本体（ZIP）
├── configs\              ← 設定ファイル
└── scripts\
    ├── setup-dev-env-v2.ps1      ← インストール
    ├── apply-configs.ps1          ← 設定適用
    ├── check-installed.ps1        ← 状況確認
    ├── uninstall-dev-env.ps1      ← アンインストール
    └── download-packages.ps1      ← ダウンロード（オンライン）
```

詳細な実装は [csv-script-setup.md](csv-script-setup.md) を参照してください。

---

## 参考：ハイブリッド方式

「一部のツールはパッケージマネージャー、設定は自作スクリプト」という組み合わせも可能ですが、以下のデメリットがあります。

| デメリット | 説明 |
|------------|------|
| 管理の複雑化 | 2つの仕組みを理解・維持する必要 |
| バージョン管理の分散 | どこで何を管理しているか把握しにくい |
| トラブルシューティング | 問題発生時の切り分けが困難 |

**オフライン環境では「自作スクリプトに統一」が最もシンプル**です。
